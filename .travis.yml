language: python
sudo: false
services: docker
dist: trusty

jobs:
    include:
        - stage: example
          script:
              - travis_retry timeout 120 docker pull fb77/reproducible
              - docker run -itd --name dock -v $(pwd):/repro fb77/reproducible
              - docker exec dock bash -c "cd repro/example && doit"

        - stage: website
          script:
              - travis_retry timeout 120 docker pull python:3.7
              - docker run -itd --name sphinx -v $(pwd):/repro python:3.7
              - docker exec sphinx bash -c "pip3 install sphinx sphinx-rtd-theme recommonmark doit pyyaml openpyxl"
              - docker exec sphinx bash -c "cd repro && doit"

          deploy:
              privder: pages
              skip_cleanup: true
              github_token: $TRAVIS_GH_PAGES_KEY
              local_dir: ".build/"
              on:
                  branch: master
